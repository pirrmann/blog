---
layout: post
title: "More colors in terminal"
tags: F#, Terminal, XTerm
---

After releasing [ColoredPrintf][coloredprintf] I started investigating color terminals, especially how some terminals
can display more than the traditional 16 colors.

While on windows console colors are changed using a call to the
[`SetConsoleTextAttribute`][msdn_consoletextattr] API, on unix XTerm and other terminals follow the way the VT100
physical terminal did it with special [escape sequences][wikipedia] that are sent to the terminal but change it's
behavior instead of being displayed.

It is especially interesting as such terminals are becomming more and more present, even in the windows world. The
excelent [ConEmu][conemu] support lot of the codes, the venerable `cmd.exe` can be told to interpret them (as we'll
see later) and it'll even soon [gain True Color support too][windows10truecolor].

Using F# to play it
-------------------

Escape sequences are generated by printing the **`ESC`** (`0x1B)` character followed by parameters and ending with a command,
the full list is on [Wikipedia][wikipedia] or [MSDN][msdn_vt100].

The cool thing is that [Visual Studio Code][vscode] integrated terminal support most of them and that the REPL
provided by the [Ionide plugin][ionide] uses it. So we can use the F# REPL integrated in VS Code to test that,
cool !

```fsharp
let esc = string (char 0x1B)
System.Console.WriteLine(esc + "[31;1m" + "Hello world" + esc + "[0m")
```

Will display `Hello World` in bright red as `m` is the graphic command taking sub-commands separated by `;`, `31` is the red color and `1`

with console colors
------------------------------------

Let's implement a few of the fun color codes in F#,
but we'll play

[ionide]: http://ionide.io/
[vscode]: https://code.visualstudio.com/
[conemu]: https://conemu.github.io/
[coloredprintf]: https://github.com/vbfox/ColoredPrintf
[wikipedia]: https://en.wikipedia.org/wiki/ANSI_escape_code
[msdn_vt100]: https://msdn.microsoft.com/en-us/library/windows/desktop/mt638032(v=vs.85).aspx
[msdn_consoletextattr]: https://msdn.microsoft.com/en-us/library/windows/desktop/ms686047(v=vs.85).aspx
[windows10truecolor]: https://blogs.msdn.microsoft.com/commandline/2016/09/22/24-bit-color-in-the-windows-console/
